
<!-- README.md is generated from README.Rmd. Please edit that file -->

# spbridge: Marginally interpretable spatial logistic regression with bridge processes

This is a R software repository corresponding to the manuscript

> “Marginally interpretable spatial logistic regression with bridge
> processes” by Changwoo Lee and David B. Dunson. arXiv preprint
> arXiv:2412.04744 <https://arxiv.org/abs/2412.04744>

## Installation

You can install the development version from
[GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("changwoo-lee/spbridge", build_manual = TRUE)
```

## Package manual

See ?(function_name) for documentation of each function. For example,

``` r
library(spbridge)
?splogi_bridge
```

See spbridge_1.0.0.1.pdf for the package manual and all available
functions.

<!-- - bridge.R: univariate and multivariate bridge distribution and normal variance mixing distributions -->

<!-- - splogi_bridge.R: spatial logistic model with bridge process random effect, using Matern kernel -->

<!-- - splogi_bridge_lowrank.R: spatial logistic model with bridge process random effect, using low-rank Matern kernel -->

<!-- - splogi_gaussian.R: spatial logistic model with Gaussian process random effect, using Matern kernel -->

<!-- - splogi_gaussian_lowrank.R: spatial logistic model with Gaussian process random effect, using low-rank Matern kernel -->

<!-- badges: start -->

<!-- badges: end -->

## Motivation

Consider the following logistic mixed model with a spatial random effect
for spatially indexed binary data:

$$
\mathrm{logit}\{\mathrm{Pr}(Y_{ij} = 1 \mid x_{ij}, u(s_i))\} = x_{ij}^T\beta + u(s_i), \quad u(\cdot)\sim \text{ mean zero process}
$$

where $i=1,\dots,n$, $j=1,\dots,N_i$, $Y_{ij}$ is a binary response at
location $i$ and individual $j$, $x_{ij}$ is a vector of covariates,
$\beta$ is a vector of regression coefficients, and $u(s_i)$ is a
spatial random effect at location $s_i$. When $N_i=1$ for all $i$, this
reduces to point-referenced spatial binary data.

The random effect $u(\cdot)$, a mean zero stochastic process defined on
the whole spatial domain, accounts for spatial dependence and allows for
prediction at new location in a coherent probabilistic framework. The
most popular choice of $u(\cdot)$ is the Gaussian process.

However, by adding the random effect, the log-odds interpretation of
$\beta$ is changed from population-averaged to site-specific. In other
words, $\beta$ now represents the change in the log-odds of $Y$
associated with a 1-unit increase of $x$, holding the site fixed. This
is in contrast with population-averaged interpretation from the model
$\mathrm{logit}\{\mathrm{Pr}(Y_{ij} = 1 \mid x_{ij})\} = x_{ij}^T\beta^M$
(as usual interpretation in logistic regression without random effects),
where $\beta^M$ represents the change in the log-odds of $Y$ associated
with a 1-unit increase of $x$ without conditioning on the site. When
$u(\cdot)$ is a Gaussian process, the induced model for
$\mathrm{logit}\{\mathrm{Pr}(Y_{ij} = 1 \mid x_{ij})\}$ is no longer a
linear function of $x_{ij}$, and marginal interpretation of regression
coefficient is lost.

We develop a marginally interpretable spatial logistic model for
researchers who wish to **(1) have both population-averaged and
site-specific log-odds ratio interpretation of regression parameters,
(2) take account of spatial dependence, and (3) enable prediction of
probability of $Y$ at a new location, all in a single modeling
framework**. Extending the work of [Wang and Louis (2003)](#references),
we propose a novel stochastic process called bridge process for spatial
random effects based on normal scale mixture that allows marginal
interpretation of regression coefficients in spatial logistic
regression. Under a Bayesian framework, the inference is carried out
with highly efficient MCMC algorithm leveraging normal mixture
representation and Polya-Gamma data augmentation [(Polson et al.,
2013)](#references).

## Case study: Childhood malaria in the Gambia

We analyze childhood malaria prevalence data in the Gambia. It contains
$\sum_{i=1}^n N_i = 2035$ children’s malaria infection statuses from
$n=65$ villages, along with covariates including age, bed net use, net
treatment with insecticides, a satellite-derived measure of greenness,
and the presence of a health center in the villages. The study of
population-averaged associations between malaria prevalence and
covariates is useful for nationwide decision-making; for example, on
supplying bed nets. Prediction of malaria prevalence at new locations is
also of substantial interest.

### 1. Data preparation

We first load data from geoR package, and standardize the data following
[Gelman et al (2008)](#references).

``` r
library(spbridge)
data(gambia)
N = length(gambia$pos) # 2035
y = gambia$pos # binary response, N = 2035 by 1 vector
# define id based on spatial coords unique values
id = as.numeric(factor(paste(gambia$x, gambia$y))) 
n = length(unique(id)) # 65
coords = unique(cbind(gambia$x, gambia$y)/1000) # n by 2 matrix, in km

# standardized covariates following Gelman et al (2008)
intercept = rep(1,N) # intercept
age = scale(gambia$age/365, scale = 2*sd(gambia$age/365)) # in years
netuse = gambia$netuse - mean(gambia$netuse)
treated = gambia$treated - mean(gambia$treated)
green = scale(gambia$green, scale = 2*sd(gambia$green))
green2 = scale(gambia$green^2, scale = 2*sd(gambia$green^2))
healthctr = gambia$phc - mean(gambia$phc)

X = cbind(intercept, age, netuse, treated, green, green2, healthctr)
colnames(X) = c("(Intercept)", "age", "netuse", "treated", "green", "green2", "healthctr")

centers = c(attr(age, "scaled:center"), mean(gambia$netuse), mean(gambia$treated), 
            attr(green, "scaled:center"), attr(green2, "scaled:center"), mean(gambia$phc))
scales = c(attr(age, "scaled:scale"), 1, 1, attr(green, "scaled:scale"), attr(green2, "scaled:scale"), 1)
  
```

### 2. Fit the model

Now we fit the spatial logistic model with bridge process random effect
for inference of both $\beta^M$ and $\beta$, as well as Gaussian process
random effects for comparison of site-specific estimate $\beta$. We
closely followed the choice of prior suggested by [Gelman
(2006)](#references) and [Gelman et al (2008)](#references), e.g. Cauchy
prior for regression coefficients; see the manuscript for detailed
settings. Running times are less than 2 mins for 11,000 iteration under
Apple M1 CPU environment.

``` r
# spatial logistic model with bridge process random effect
fit_bridge = spbridge::splogi_bridge(y = y,
                   X = X,
                   id = id,
                   priors = list(beta_intercept_scale = 10,
                                 beta_scale = 2.5, beta_df = Inf, 
                                 rho_lb = 0.01, rho_ub = 100),
                   coords = coords,
                   smoothness = 0.5, nburn = 1000, nsave = 10000, nthin = 1)
#> [1] "Finding phi using pairwise composite likelihood..."
#> [1] "phihat =0.894879804045751"
#>   |                                                                              |                                                                      |   0%  |                                                                              |                                                                      |   1%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |==                                                                    |   4%  |                                                                              |===                                                                   |   4%  |                                                                              |===                                                                   |   5%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |=====                                                                 |   8%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |=======                                                               |  11%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |=========                                                             |  14%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  16%  |                                                                              |============                                                          |  17%  |                                                                              |============                                                          |  18%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |==============                                                        |  21%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  22%  |                                                                              |================                                                      |  23%  |                                                                              |================                                                      |  24%  |                                                                              |=================                                                     |  24%  |                                                                              |=================                                                     |  25%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |===================                                                   |  28%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |=====================                                                 |  31%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |=======================                                               |  34%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |==========================                                            |  38%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  39%  |                                                                              |============================                                          |  40%  |                                                                              |============================                                          |  41%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |==============================                                        |  44%  |                                                                              |===============================                                       |  44%  |                                                                              |===============================                                       |  45%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |=================================                                     |  48%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |===================================                                   |  51%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |=====================================                                 |  54%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  56%  |                                                                              |========================================                              |  57%  |                                                                              |========================================                              |  58%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |==========================================                            |  61%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  62%  |                                                                              |============================================                          |  63%  |                                                                              |============================================                          |  64%  |                                                                              |=============================================                         |  64%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |===============================================                       |  68%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |=================================================                     |  71%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |===================================================                   |  74%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  76%  |                                                                              |======================================================                |  77%  |                                                                              |======================================================                |  78%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  79%  |                                                                              |========================================================              |  80%  |                                                                              |========================================================              |  81%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |==========================================================            |  84%  |                                                                              |===========================================================           |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |=============================================================         |  88%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |===============================================================       |  91%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |=================================================================     |  94%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |====================================================================  |  98%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================|  99%  |                                                                              |======================================================================| 100%
fit_bridge$t_mcmc
#> Time difference of 37.96073 secs
# spatial logistic model with Gaussian process random effect
fit_gaussian = spbridge::splogi_gaussian(y = y,
                   X = X,
                   id = id,
                   priors = list(beta_intercept_scale = 10,
                                 beta_scale = 2.5, beta_df = Inf, 
                                 rho_lb = 0.01, rho_ub = 100),
                   coords = coords,
                   smoothness = 0.5, nburn = 1000, nsave = 10000, nthin = 1)
#>   |                                                                              |                                                                      |   0%  |                                                                              |                                                                      |   1%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |==                                                                    |   4%  |                                                                              |===                                                                   |   4%  |                                                                              |===                                                                   |   5%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |=====                                                                 |   8%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |=======                                                               |  11%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |=========                                                             |  14%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  16%  |                                                                              |============                                                          |  17%  |                                                                              |============                                                          |  18%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |==============                                                        |  21%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  22%  |                                                                              |================                                                      |  23%  |                                                                              |================                                                      |  24%  |                                                                              |=================                                                     |  24%  |                                                                              |=================                                                     |  25%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |===================                                                   |  28%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |=====================                                                 |  31%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |=======================                                               |  34%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |==========================                                            |  38%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  39%  |                                                                              |============================                                          |  40%  |                                                                              |============================                                          |  41%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |==============================                                        |  44%  |                                                                              |===============================                                       |  44%  |                                                                              |===============================                                       |  45%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |=================================                                     |  48%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |===================================                                   |  51%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |=====================================                                 |  54%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  56%  |                                                                              |========================================                              |  57%  |                                                                              |========================================                              |  58%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |==========================================                            |  61%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  62%  |                                                                              |============================================                          |  63%  |                                                                              |============================================                          |  64%  |                                                                              |=============================================                         |  64%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |===============================================                       |  68%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |=================================================                     |  71%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |===================================================                   |  74%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  76%  |                                                                              |======================================================                |  77%  |                                                                              |======================================================                |  78%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  79%  |                                                                              |========================================================              |  80%  |                                                                              |========================================================              |  81%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |==========================================================            |  84%  |                                                                              |===========================================================           |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |=============================================================         |  88%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |===============================================================       |  91%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |=================================================================     |  94%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |====================================================================  |  98%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================|  99%  |                                                                              |======================================================================| 100%
fit_gaussian$t_mcmc
#> Time difference of 37.57597 secs
```

### 3. Summarize the result

Now we summarize the MCMC results after back-transforming the data in
the original scale. The conditional estimates are essentially identical.
From the proposed model, we also obtain parameters with
population-averaged interpretation as well that are comparable with
results of [Cattelan and Varin (2018)](#references). The trace plot
shows good convergence.

``` r
library(bayesplot)
#> This is bayesplot version 1.14.0
#> - Online documentation and vignettes at mc-stan.org/bayesplot
#> - bayesplot theme set to bayesplot::theme_default()
#>    * Does _not_ affect other ggplot2 plots
#>    * See ?bayesplot_theme_set for details on theme setting
scaleback <- function(x, centers, scales){
  c(x[1] - sum((x[-1] * centers) / scales),
    x[-1] / scales)
}

# summary from bridge process
beta_b_save = fit_bridge$post_save[,1:ncol(X)]
beta_b_save_orig = coda::mcmc(t(apply(beta_b_save, 1, scaleback, centers, scales)))
betam_b_save_orig = coda::mcmc(t(apply(fit_bridge$betam_save, 1, scaleback, centers, scales)))


summary(betam_b_save_orig)# population-averaged, bridge process random effect
#> 
#> Iterations = 1:10000
#> Thinning interval = 1 
#> Number of chains = 1 
#> Sample size per chain = 10000 
#> 
#> 1. Empirical mean and standard deviation for each variable,
#>    plus standard error of the mean:
#> 
#>                  Mean        SD  Naive SE Time-series SE
#> (Intercept)  2.064318 2.4645570 2.465e-02      3.716e-02
#> age          0.218970 0.0402711 4.027e-04      4.831e-04
#> netuse      -0.327625 0.1401450 1.401e-03      1.534e-03
#> treated     -0.321720 0.1781426 1.781e-03      2.155e-03
#> green       -0.117952 0.0940516 9.405e-04      1.057e-03
#> green2       0.001275 0.0009871 9.871e-06      1.102e-05
#> healthctr   -0.264328 0.1934545 1.935e-03      2.171e-03
#> 
#> 2. Quantiles for each variable:
#> 
#>                   2.5%        25%       50%       75%    97.5%
#> (Intercept) -2.8184590  0.4052062  2.080688  3.758586  6.92683
#> age          0.1409062  0.1917504  0.218909  0.245978  0.29681
#> netuse      -0.5996052 -0.4194694 -0.329521 -0.233454 -0.05332
#> treated     -0.6699172 -0.4401700 -0.322134 -0.199711  0.02992
#> green       -0.2982147 -0.1822876 -0.119624 -0.053977  0.06894
#> green2      -0.0006926  0.0006005  0.001286  0.001956  0.00316
#> healthctr   -0.6414538 -0.3968435 -0.263790 -0.133136  0.11459

summary(beta_b_save_orig)# site(subject)-specific, bridge process random effect 
#> 
#> Iterations = 1:10000
#> Thinning interval = 1 
#> Number of chains = 1 
#> Sample size per chain = 10000 
#> 
#> 1. Empirical mean and standard deviation for each variable,
#>    plus standard error of the mean:
#> 
#>                  Mean       SD  Naive SE Time-series SE
#> (Intercept)  2.306811 2.754065 2.754e-02      4.152e-02
#> age          0.244692 0.045002 4.500e-04      5.398e-04
#> netuse      -0.366111 0.156608 1.566e-03      1.714e-03
#> treated     -0.359512 0.199069 1.991e-03      2.408e-03
#> green       -0.131808 0.105100 1.051e-03      1.181e-03
#> green2       0.001425 0.001103 1.103e-05      1.231e-05
#> healthctr   -0.295379 0.216179 2.162e-03      2.427e-03
#> 
#> 2. Quantiles for each variable:
#> 
#>                  2.5%        25%       50%       75%     97.5%
#> (Intercept) -3.149539  0.4528052  2.325103  4.200101  7.740517
#> age          0.157458  0.2142751  0.244623  0.274872  0.331677
#> netuse      -0.670040 -0.4687439 -0.368230 -0.260878 -0.059587
#> treated     -0.748611 -0.4918761 -0.359975 -0.223170  0.033437
#> green       -0.333246 -0.2037006 -0.133675 -0.060318  0.077042
#> green2      -0.000774  0.0006711  0.001437  0.002186  0.003531
#> healthctr   -0.716804 -0.4434601 -0.294777 -0.148776  0.128049

# Compare with Gaussian process random effects model
beta_g_save = fit_gaussian$post_save[,1:ncol(X)]
beta_g_save_orig = coda::mcmc(t(apply(beta_g_save, 1, scaleback, centers, scales)))
summary(beta_g_save_orig)# site(subject)-specific, Gaussian process random effect
#> 
#> Iterations = 1:10000
#> Thinning interval = 1 
#> Number of chains = 1 
#> Sample size per chain = 10000 
#> 
#> 1. Empirical mean and standard deviation for each variable,
#>    plus standard error of the mean:
#> 
#>                  Mean       SD  Naive SE Time-series SE
#> (Intercept)  2.409241 2.747948 2.748e-02      3.776e-02
#> age          0.244341 0.044020 4.402e-04      5.129e-04
#> netuse      -0.363902 0.157063 1.571e-03      1.724e-03
#> treated     -0.360419 0.201115 2.011e-03      2.383e-03
#> green       -0.132378 0.104243 1.042e-03      1.181e-03
#> green2       0.001413 0.001093 1.093e-05      1.225e-05
#> healthctr   -0.296709 0.214862 2.149e-03      2.344e-03
#> 
#> 2. Quantiles for each variable:
#> 
#>                   2.5%        25%       50%       75%    97.5%
#> (Intercept) -3.0363666  0.5283384  2.410773  4.257776  7.78626
#> age          0.1582189  0.2142918  0.244276  0.274395  0.33113
#> netuse      -0.6708927 -0.4689978 -0.365185 -0.259260 -0.05364
#> treated     -0.7589290 -0.4941317 -0.359923 -0.225483  0.03550
#> green       -0.3347420 -0.2033652 -0.133046 -0.061946  0.07429
#> green2      -0.0007332  0.0006846  0.001421  0.002148  0.00352
#> healthctr   -0.7181059 -0.4394811 -0.294242 -0.156999  0.12287
```

``` r
# further mcmc summary examples
library(bayesplot)
mcmc_trace(fit_bridge$post_save)
```

![](README_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->

``` r
mcmc_trace(fit_gaussian$post_save)
```

![](README_files/figure-gfm/unnamed-chunk-7-2.png)<!-- -->

### References

- Cattelan, M. and Varin, C. (2018). Marginal logistic regression for
  spatially clustered binary data. J. R. Stat. Soc. Ser. C. Appl. Stat.,
  67(4):939–959

- Gelman, A. (2006). Prior distributions for variance parameters in
  hierarchical models. Bayesian Anal., 1(3):515–534.

- Gelman, A., Jakulin, A., Pittau, M. G., and Su, Y.-S. (2008). A weakly
  informative default prior distribution for logistic and other
  regression models. Ann. Appl. Stat., 2(4):1360–1383.

- Polson, N. G., Scott, J. G., and Windle, J. (2013). Bayesian inference
  for logistic models using Pólya–Gamma latent variables. J. Am.
  Statist. Assoc., 108(504):1339–1349.

- Wang, Z. and Louis, T. A. (2003). Matching Conditional and Marginal
  Shapes in Binary Random Intercept Models Using a Bridge Distribution
  Function. Biometrika, 90(4):765–775.
